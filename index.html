<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Thinkphp-demo by liuwill</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Thinkphp-demo</h1>
        <h2>thinkPHP RBAC演示程序</h2>
        <a href="https://github.com/liuwill/thinkphp-demo" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="thinkphp-rbac演示系统" class="anchor" href="#thinkphp-rbac%E6%BC%94%E7%A4%BA%E7%B3%BB%E7%BB%9F" aria-hidden="true"><span class="octicon octicon-link"></span></a>ThinkPHP RBAC演示系统</h1>

<blockquote>
<p>基于ThinkPHP RBAC模块开发的演示程序</p>

<p>演示网址:<a href="http://www.liuwill.com/thinkphp/index.php/Admin/Index">Demo</a></p>
</blockquote>

<h2>
<a id="项目说明" class="anchor" href="#%E9%A1%B9%E7%9B%AE%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>项目说明</h2>

<p>该项目是为了展示使用 <code>ThinkPHP RBAC</code> 模块而编写的简单演示系统，通过操作角色和权限相关表，实现后台模块的基于角色的权限管理。该系统使用<code>Jquery+Bootstrap</code>作为前端框架，界面风格是仿阿里云的管理控制台实现的；目前未增加响应式支持。页面渲染基本采用ThinkPHP视图模版，只有功能使用JS交互代码。</p>

<p>实现过程中，对前端进行了类似SPA的模块化划分，在配置文件中接收控制器中注册的模块名，然后动态加载模块对应的交互代码；整个前端模版，只有一个主模块页面，包含了公共的界面框架；控制器中根据注册的模块名，加载对应的子模块模版，模版的代码位于<code>main/thinkphp/Public/templete</code>中，预计今后可能会移到<code>src/templete</code>中，部署的时候由自动化构建工具打包到Public目录下的templete。</p>

<h3>
<a id="自动化构建" class="anchor" href="#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%9E%84%E5%BB%BA" aria-hidden="true"><span class="octicon octicon-link"></span></a>自动化构建</h3>

<p>系统采用自动化构建工作流来实现项目的编译和打包，将<code>main</code>和<code>src</code>下面的文件先在<code>build</code>中进行预处理，然后全部打包到<code>deploy</code>目录，之后在该目录中就可以运行，将<code>deploy/thinkphp</code>、<code>deploy/static</code>分别拷贝到apache虚拟目录的根目录下，就可以访问系统。</p>

<p>自动化构建工具使用的是<code>grunt</code>，会对js代码进行压缩，然后将sass编译成css，进过压缩之后拷贝到最后的部署目录，过程中，还要将依赖文件加上md5验证码，然后替换模版中对静态文件的引用。然后把bower管理的模块，还有thinkPHP框架也一起打包到部署目录，在这个系统中，还会使用grunt-php可以直接轻量化的运行打包好的代码</p>

<h6>
<a id="运行命令" class="anchor" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4" aria-hidden="true"><span class="octicon octicon-link"></span></a>运行命令</h6>

<p><code>grunt prepare</code> - 执行clean:build命令，清除build和deploy</p>

<p><code>grunt build</code> - 编译sass和js，并且将需要编译处理的源文件拷贝到build中，对build中的中间文件进行处理，得到最终的文件</p>

<p><code>grunt deploy</code> - 将bower管理的包，还有编译过的静态文件，thinkPHP框架，打包到deploy目录</p>

<p><code>grunt execute</code> - 运行deploy中已经单独进行过打包的项目</p>

<p><code>grunt deploy_pack</code> - 通过prepare、build、deploy对项目进行一键打包</p>

<p><code>grunt execute_all</code> - 一键打包，并且用grunt-php来运行项目</p>

<h3>
<a id="配置说明" class="anchor" href="#%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>配置说明</h3>

<p>在这里，需要通过对thinkPHP进行配置，来设置运行时的一些特性，在thinkPHP下面的<code>Application/Common/Conf/config.php</code>。代码中配置文件的命名是<code>config_dev.php</code>需要修改文件名，改成<code>config.php</code>。</p>

<pre lang="thinkPHP配置文件"><code>    'URL_MODEL'          =&gt; '4',    //
    'URL_HTML_SUFFIX'    =&gt; '', //不添加任何伪扩展名
    'adminname'=&gt;'adminname',
    'DB_TYPE'   =&gt; 'mysql', // 数据库类型
    'DB_HOST'   =&gt; 'localhost', // 服务器地址
    'DB_NAME'   =&gt; 'dbschema', // 数据库名
    'DB_USER'   =&gt; 'username', // 用户名
    'DB_PWD'    =&gt; 'password', // 密码
    'DB_PORT'   =&gt; 3306, // 端口
    'DB_PREFIX' =&gt; '', // 数据库表前缀 
    'DB_CHARSET'=&gt; 'utf8', // 字符集
    'DB_DEBUG'  =&gt;  TRUE, // 数据库调试模式 开启后可以记录SQL日志
    'APP_AUTOLOAD_PATH'=&gt;'@.TagLib',
    'SESSION_AUTO_START'=&gt;true,
    'USER_AUTH_ON'              =&gt;true,
    'USER_AUTH_TYPE'            =&gt;1,     // 默认认证类型 1 登录认证 2 实时认证
    'USER_AUTH_KEY'             =&gt;'uid',  // 用户认证SESSION标记
    'ADMIN_AUTH_KEY'            =&gt;'u1000', //如果think_role_user中的user_id使用的是数字，需要和字符串拼接
    'USER_AUTH_MODEL'           =&gt;'admin_user',    // 默认验证数据表模型
    'AUTH_PWD_ENCODER'          =&gt;'md5', // 用户认证密码加密方式
    'USER_AUTH_GATEWAY'         =&gt;'/Admin/Public/login',// 默认认证网关
    'NOT_AUTH_MODULE'           =&gt;'Public',  // 默认无需认证模块
    'REQUIRE_AUTH_MODULE'       =&gt;'',        // 默认需要认证模块
    'NOT_AUTH_ACTION'           =&gt;'',        // 默认无需认证操作
    'REQUIRE_AUTH_ACTION'       =&gt;'',        // 默认需要认证操作
    'GUEST_AUTH_ON'             =&gt;false,    // 是否开启游客授权访问
    'GUEST_AUTH_ID'             =&gt;0,        // 游客的用户ID
    'DB_LIKE_FIELDS'            =&gt;'title|remark',
    'RBAC_ROLE_TABLE'           =&gt;'think_role',
    'RBAC_USER_TABLE'           =&gt;'think_role_user',
    'RBAC_ACCESS_TABLE'         =&gt;'think_access',
    'RBAC_NODE_TABLE'           =&gt;'think_node',
    'SHOW_PAGE_TRACE'=&gt;1//显示调试信息
</code></pre>

<h4>
<a id="运行命令-1" class="anchor" href="#%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>运行命令</h4>

<p><code>grunt prepare</code> - 执行clean:build命令，清除build和deploy</p>

<p><code>grunt build</code> - 编译sass和js，并且将需要编译处理的源文件拷贝到build中，对build中的中间文件进行处理，得到最终的文件</p>

<p><code>grunt deploy</code> - 将bower管理的包，还有编译过的静态文件，thinkPHP框架，打包到deploy目录</p>

<p><code>grunt execute</code> - 运行deploy中已经单独进行过打包的项目</p>

<p><code>grunt deploy_pack</code> - 通过prepare、build、deploy对项目进行一键打包</p>

<p><code>grunt execute_all</code> - 一键打包，并且用grunt-php来运行项目</p>

<h4>
<a id="系统访问路径" class="anchor" href="#%E7%B3%BB%E7%BB%9F%E8%AE%BF%E9%97%AE%E8%B7%AF%E5%BE%84" aria-hidden="true"><span class="octicon octicon-link"></span></a>系统访问路径</h4>

<p>Url: <code>/thinkphp/Admin/Index/index</code><br>
Desc: 系统控制台首页</p>

<p>包括角色管理功能，还有提供的几个演示功能。</p>

<h5>
<a id="登录页面" class="anchor" href="#%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2" aria-hidden="true"><span class="octicon octicon-link"></span></a>登录页面</h5>

<p>Url: <code>/thinkphp/Admin/Public/login</code><br>
Desc: 登录页面</p>

<h3>
<a id="目录文件说明" class="anchor" href="#%E7%9B%AE%E5%BD%95%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E" aria-hidden="true"><span class="octicon octicon-link"></span></a>目录文件说明</h3>

<p>thinkPHP代码，位于main目录下；整个控制台只有一个主要的视图模版<code>Application/Admin/View/Index/index.html</code>,所有控制台主要面板都会加载这个模版。通过绑定变量<code>mainBodyPath</code>来指定要访问的具体模块功能模版片段的文件名；<code>moduleName</code>指定js交互脚本加载的对应模块，采用类似Angular的组织方式，所有静态片段代码放在<code>Public/templete</code>目录下。</p>

<p>其中，控制台控制器，有一个积累<code>CommonRbacController</code>，该类进行了一些必要的预处理。</p>

<p>相关的路径说明：</p>

<ul>
<li>
<code>Application/Admin/Controller</code> 涉及到后台控制台的相关代码</li>
<li>
<code>Application/Admin/View</code> 由控制器直接加载的模版，目前包括控制台的主要区域还有登录页面</li>
<li>
<code>Public/templete</code> 根据不同模块，由include加载进来的模版片段</li>
<li>
<code>Public/fonts</code> 系统用到的字体文件</li>
<li>
<code>Application/Common/Common</code> 一些自定义的公共函数库</li>
<li>
<code>Application/Common/Library</code> 一些自定义的公共类库</li>
<li>
<code>Application/Admin/Common</code> Admin下自定义的公共函数库</li>
</ul>

<h2>
<a id="环境依赖" class="anchor" href="#%E7%8E%AF%E5%A2%83%E4%BE%9D%E8%B5%96" aria-hidden="true"><span class="octicon octicon-link"></span></a>环境依赖</h2>

<p>该系统基于ThinkPHP开发 <code>版本3.2.3</code></p>

<p>使用ThinkPHP自带的RBAC模块，还有数据库结构，进行权限控制。该系统使用npm+Grunt+Bower工作流的方式，自动化构建和打包</p>

<pre lang="Grunt模块"><code>{
  ……
  "devDependencies": {
    "grunt": "^0.4.5",
    "grunt-php":"^1.5.1",
    "grunt-contrib-connect":"^0.1.2",
    "grunt-contrib-uglify": "^0.8.0",
    "grunt-concat": "^0.1.6",
    "load-grunt-tasks": "^3.1.0",
    "grunt-contrib-watch": "^0.6.1",
    "grunt-contrib-sass": "^0.9.2",
    "grunt-contrib-cssmin": "^0.14.0",
    "grunt-contrib-htmlmin": "^0.4.0",
    "grunt-sass": "^0.18.0",
    "grunt-contrib-copy": "^0.8.0",
    "grunt-contrib-clean": "^0.6.0",
    "grunt-bower-task": "^0.4.0",
    "grunt-filerev": "^2.3.1",
    "grunt-usemin": "^3.1.1",
    "grunt-autoprefixer": "^3.0.3"
  }
}
</code></pre>

<p>前端开发使用Jquery+Bootstrap作为开发框架，轻量级的实现了简单的模块化，预计以后会使用requirejs来做模块化:</p>

<pre lang="前端组件"><code>"dependencies": {
    "jquery": "1.11.3",
    "requirejs": "2.1.19",
    "bootstrap": "3.3.5"
}
</code></pre>

<h2>
<a id="目录结构脚手架" class="anchor" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84%E8%84%9A%E6%89%8B%E6%9E%B6" aria-hidden="true"><span class="octicon octicon-link"></span></a>目录结构（脚手架）</h2>

<ul>
<li>main  该目录下是完整的可运行<code>ThinkPHP</code>核心代码，所有服务器端代码， 包括视图模版。</li>
<li>src/sass  系统的样式代码，使用<code>sass</code>编写，目前未重构，是直接的css格式。</li>
<li>src/scripts  前端交互js代码，未经过压缩的原始代码。</li>
<li>resources  系统使用到的一些静态资源，包括图片或者字体。</li>
<li>build  构建中间过程中保存中间处理内容，并进行操作的目录</li>
<li>deploy  最终生成的完整部署代码，<code>deploy/thinkphp</code>下是thinkPHP框架代码，<code>deploy/static</code>下是用到的静态文件</li>
<li>database.sql  生成初始化数据的<code>sql</code>语句</li>
<li>package.json  <code>npm</code>的配置文件，根据配置文件安装<code>grunt</code>模块</li>
<li>bower.json  配置前端依赖的模块，<code>bower</code>根据配置来进行安装，<code>exportsOverride</code>会覆盖原来模块默认的导出规则</li>
<li>Gruntfile.js  <code>Grunt</code>执行脚本，配置grunt执行各种自动化构建和打包任务</li>
</ul>

<hr>

<p>个人网站 by <a href="http://www.liuwill.com">"LiuWill" 刘伟</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/liuwill/thinkphp-demo/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/liuwill/thinkphp-demo/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/liuwill/thinkphp-demo"></a> is maintained by <a href="https://github.com/liuwill">liuwill</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-68765969-2");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
